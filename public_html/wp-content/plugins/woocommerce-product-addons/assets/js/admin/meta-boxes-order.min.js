jQuery(function(c){var i=c("#woocommerce-order-items"),d=!1,r={handle_events:function(){i.on("click","button.configure_addons",{action:"configure"},this.clicked_edit_button).on("click","button.edit_addons",{action:"edit"},this.clicked_edit_button).on("wc_pb_populate_form wc_cp_populate_form",(e,a)=>{d=a,r.render_form()}).on("wc_pb_validate_form wc_cp_validate_form",(e,a)=>{a.is_valid&&(a.is_valid=a.validation.validate(!0))})},clicked_edit_button:function(e){var a=c.WCBackboneModal.View.extend({addButton:r.clicked_done_button}),t=c(this).closest("tr.item").attr("data-order_item_id");return d=new a({target:"wc-modal-edit-addon",string:{action:"configure"===e.data.action?wc_pao_admin_order_params.i18n_configure:wc_pao_admin_order_params.i18n_edit,item_id:t}}),r.populate_form(),!1},clicked_done_button:function(a){var e=c.extend({},r.get_taxable_address(),{action:"woocommerce_edit_addon_order_item",item_id:d._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_pao_admin_order_params.edit_pao_nonce}),t=d.$el.find("form")[0];if(d.validation.validate(!0)){var o=new FormData(t);for(const n in e)o.append(n,e[n]);r.block(d.$el.find(".wc-backbone-modal-content")),c.post({url:woocommerce_admin_meta_boxes.ajax_url,type:"POST",data:o,processData:!1,contentType:!1,cache:!1,success:function(e){e.result&&"success"===e.result?(i.find(".inside").empty(),i.find(".inside").append(e.html),i.trigger("wc_order_items_reloaded"),e.notes_html&&(c("ul.order_notes").empty(),c("ul.order_notes").append(c(e.notes_html).find("li"))),r.unblock(d.$el.find(".wc-backbone-modal-content")),r.block(i,{fadeIn:0}),setTimeout(function(){r.unblock(i)},250),d.closeButton(a)):(window.alert(e.error||wc_pao_admin_order_params.i18n_validation_error),r.unblock(d.$el.find(".wc-backbone-modal-content")))},error:function(){window.alert(wc_pao_admin_order_params.i18n_validation_error),r.unblock(d.$el.find(".wc-backbone-modal-content"))}})}},populate_form:function(){r.block(d.$el.find(".wc-backbone-modal-content"));var e={action:"woocommerce_configure_addon_order_item",item_id:d._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_pao_admin_order_params.edit_pao_nonce};c.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e.result&&"success"===e.result?(d.$el.find("form").html(e.html),r.unblock(d.$el.find(".wc-backbone-modal-content")),r.render_form()):(window.alert(wc_pao_admin_order_params.i18n_form_error),r.unblock(d.$el.find(".wc-backbone-modal-content")),d.$el.find(".modal-close").trigger("click"))})},render_form:function(){var n;d.$el.on("blur change",".wc-pao-addon input, .wc-pao-addon textarea, .wc-pao-addon select, .wc-pao-addon-custom-text",function(){d.validation.validateAddon(c(this),!0)}),d.$el.on("keyup",".wc-pao-addon input, .wc-pao-addon textarea, .wc-pao-addon-custom-text",function(){var e,a,t=c(this);e=function(){d.validation.validateAddon(t,!0)},a=300,clearTimeout(0),setTimeout(e,a)}),d.$el.on("touchstart",".wc-pao-addon-image-swatch",function(e){n=new Date}),d.$el.on("click touchend",".wc-pao-addon-image-swatch",function(e){if((e.preventDefault(),"touchend"===e.type&&n)&&100<new Date-n)return;var e=c(this).data("value"),a=c(this).parents(".wc-pao-addon-wrap"),t=c.parseHTML(c(this).data("price")),o=a.find(".wc-pao-addon-image-swatch-selected-swatch");o.html(""),a.find(".wc-pao-addon-image-swatch").removeClass("selected"),c(this).addClass("selected"),a.find(".wc-pao-addon-image-swatch-select").val(e),o.html(t),d.validation.validateAddon(a.find("select.wc-pao-addon-field"),!0)}),d.$el.find(".datepicker").each(function(){var t=c(this),e=t.parent(),o=e.find(".reset_date"),n=e.find('input[name="'+t.attr("name")+'-wc-pao-date"]'),a=e.find('input[name="'+t.attr("name")+'-wc-pao-date-gmt-offset"]'),e=(a.length||((a=c("<input/>")).attr("type","hidden"),a.attr("name",t.attr("name")+"-wc-pao-date-gmt-offset"),e.append(a)),new Date),i=parseFloat(wc_pao_admin_order_params.gmt_offset,10),d=e.getTimezoneOffset()/60,a=("default"===wc_pao_admin_order_params.date_input_timezone_reference?a.val(d):"store"===wc_pao_admin_order_params.date_input_timezone_reference&&(e.getHours(),e.getMinutes(),a.val(i)),t.datepicker({beforeShow:function(e,a){wc_pao_admin_order_params.datepicker_class&&(c("#ui-datepicker-div").removeClass(wc_pao_admin_order_params.datepicker_class),c("#ui-datepicker-div").addClass(wc_pao_admin_order_params.datepicker_class))},dateFormat:wc_pao_admin_order_params.datepicker_date_format,changeMonth:!0,changeYear:!0,yearRange:"c-100:c+10"}),t.datepicker("getDate"));null!==a&&"function"==typeof a.getTime&&(a.setHours(e.getHours(),e.getMinutes()),"store"===wc_pao_admin_order_params.date_input_timezone_reference&&(a=WC_PAO.Helper.addMinutes(a,-1*d*60),a=WC_PAO.Helper.addMinutes(a,60*i)),n.val(a.getTime()/1e3),o.show()),t.on("change",function(){var e,a=t.datepicker("getDate");null!==a&&"function"==typeof a.getTime?(e=new Date,a.setHours(e.getHours(),e.getMinutes()),"store"===wc_pao_admin_order_params.date_input_timezone_reference&&(a=WC_PAO.Helper.addMinutes(a,-1*d*60),a=WC_PAO.Helper.addMinutes(a,60*i)),n.val(a.getTime()/1e3),o.show()):(o.hide(),n.val(""))}),o.on("click",function(e){e.preventDefault(),n.val(""),t.val("").trigger("change")})}),d.$addons=d.$el.find(".wc-pao-addon-field"),d.validation=new PaoValidation(d),d.validation.validate()},get_taxable_address:function(){var e="",a="",t="",o="";return"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(e=c("#_shipping_country").val(),a=c("#_shipping_state").val(),t=c("#_shipping_postcode").val(),o=c("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&e||(e=c("#_billing_country").val(),a=c("#_billing_state").val(),t=c("#_billing_postcode").val(),o=c("#_billing_city").val()),{country:e,state:a,postcode:t,city:o}},block:function(e,a){a=c.extend({},{message:null,overlayCSS:{background:"#fff",opacity:.6}},a||{});e.block(a)},unblock:function(e){e.unblock()}};r.handle_events()});